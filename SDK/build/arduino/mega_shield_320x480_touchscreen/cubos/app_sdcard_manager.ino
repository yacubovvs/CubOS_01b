
/*
 * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 
 * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *
 * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *
 *                                                                                         *
 *                                                                                         *
 *                                  >>>   IMPORTANT!   <<<                                 *
 *                   DO NOT FORGET TO ADD YOU APP IN os_applications.ino                   *
 *                                                                                         *
 *                                                                                         *
 * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 
 * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *
 * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *
 */

#define appNameClass    SDAppManager         // App name without spaces
#define appName         "SD Card"      // App name with spaces (max 16)

#ifndef do_Not_use_native_apps
  class appNameClass: public Application{
      public:
          virtual void loop() override;
          void setup();

          appNameClass(){ // Constructor
              setup();
          };

          const static byte icon[];

              static unsigned const char* getParams(unsigned char type){
              switch(type){ 
                case PARAM_TYPE_NAME: return (unsigned char*)appName; 
                case PARAM_TYPE_ICON: return icon;
                default: return (unsigned char*)""; }
          };

  };

  const byte appNameClass::icon[] PROGMEM = { //128
    //////////////////////////////////////////////////////////////
    //		PUT YOUR ICON HERE
  #ifdef colorScreen
    0x02,0x01,0x02,0x20,0x02,0x20,0x04,0xff,0xd9,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
    0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x0A,0xA8,0x00,0x00,0x0A,0xA8,0x00,0x00,0x0A,0xA8,0x00,0x00,0x0A,0xA8,0x00,0x00,0x00,0x00,0x00,
    0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
    0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
    0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
    0x00,0x00,0x00,0x04,0xFF,0xFF,0xFF,0x1F,0xFF,0xFF,0xF8,0x3F,0xFF,0xFF,0xFC,0x7F,0xFF,0xFF,0xFE,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,
    0xFF,0xE0,0x01,0xFF,0xFF,0xC0,0x01,0xFF,0xFF,0xC0,0x01,0xFF,0xFF,0xC0,0x01,0xFF,0xFF,0xC0,0x01,0xFF,0xFF,0xC0,0x01,0xFF,0xFF,0xC0,0x01,
    0xFF,0xFF,0x80,0x01,0xFF,0xFF,0x00,0x01,0xFF,0xFE,0x00,0x01,0xFF,0xFE,0x00,0x01,0xFF,0xFE,0x00,0x01,0xFF,0xFF,0x80,0x01,0xFF,0xFF,0x80,
    0x01,0xFF,0xFF,0x00,0x01,0xFF,0xFE,0x00,0x01,0xFF,0xFE,0x00,0x01,0xFF,0xFE,0x00,0x01,0xFF,0xFE,0x00,0x01,0xFF,0xFE,0x00,0x01,0xFF,0xFF,
    0x00,0x03,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0x7F,0xFF,0xFF,0xFE,0x3F,0xFF,0xFF,0xFC,0x1F,0xFF,0xFF,0xF8,
    0x04,0x8f,0x8f,0x8f,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
    0x00,0x00,0x15,0x54,0x00,0x00,0x15,0x54,0x00,0x00,0x15,0x54,0x00,0x00,0x15,0x54,0x00,0x00,0x1F,0xFC,0x00,0x00,0x1F,0xFC,0x00,0x00,0x3F,
    0xFC,0x00,0x00,0x7F,0xFC,0x00,0x00,0xFF,0xFC,0x00,0x00,0xFF,0xFC,0x00,0x00,0x3F,0xFC,0x00,0x00,0x3F,0xFC,0x00,0x00,0x3F,0xFC,0x00,0x00,
    0x7F,0xFC,0x00,0x00,0xFF,0xFC,0x00,0x00,0xFF,0xFC,0x00,0x00,0xFF,0xFC,0x00,0x00,0xFF,0xFC,0x00,0x00,0xFF,0xFC,0x00,0x00,0x00,0x00,0x00,
    0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x04,0x00,0x00,
    0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x1F,0xFE,0x00,0x00,0x20,
    0x02,0x00,0x00,0x20,0x02,0x00,0x00,0x20,0x02,0x00,0x00,0x20,0x02,0x00,0x00,0x20,0x02,0x00,0x00,0x20,0x02,0x00,0x00,0x40,0x02,0x00,0x00,
    0x80,0x02,0x00,0x01,0x00,0x02,0x00,0x01,0x00,0x02,0x00,0x01,0xC0,0x02,0x00,0x00,0x40,0x02,0x00,0x00,0x40,0x02,0x00,0x00,0x80,0x02,0x00,
    0x01,0x00,0x02,0x00,0x01,0x00,0x02,0x00,0x01,0x00,0x02,0x00,0x01,0x00,0x02,0x00,0x01,0x00,0x02,0x00,0x00,0xFF,0xFC,0x00,0x00,0x00,0x00,
    0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
  #else
    0x02,0x01,0x02,0x20,0x02,0x20,0x04,0x00,0x00,0x00,0x1F,0xFF,0xFF,0xF8,0x20,0x00,0x00,0x04,0x40,0x00,0x00,0x02,0x80,0x00,0x00,0x01,0x80,
    0x00,0x00,0x01,0x80,0x1F,0xFE,0x01,0x80,0x35,0x56,0x01,0x80,0x35,0x56,0x01,0x80,0x35,0x56,0x01,0x80,0x35,0x56,0x01,0x80,0x3F,0xFE,0x01,
    0x80,0x3F,0xFE,0x01,0x80,0x7F,0xFE,0x01,0x80,0xFF,0xFE,0x01,0x81,0xFF,0xFE,0x01,0x81,0xFF,0xFE,0x01,0x81,0xFF,0xFE,0x01,0x80,0x7F,0xFE,
    0x01,0x80,0x7F,0xFE,0x01,0x80,0xFF,0xFE,0x01,0x81,0xFF,0xFE,0x01,0x81,0xFF,0xFE,0x01,0x81,0xFF,0xFE,0x01,0x81,0xFF,0xFE,0x01,0x81,0xFF,
    0xFE,0x01,0x80,0xFF,0xFC,0x01,0x80,0x00,0x00,0x01,0x80,0x00,0x00,0x01,0x80,0x00,0x00,0x01,0x40,0x00,0x00,0x02,0x20,0x00,0x00,0x04,0x1F,
    0xFF,0xFF,0xF8,
  #endif
    //
    //////////////////////////////////////////////////////////////
  };

  void app_manager_boot_func(){
      currentApp = new SDAppManager();
  }

#endif

#ifndef do_Not_use_native_apps
  void appNameClass::setup(){
#else
  void SDAppManager_setup(){
#endif

    #ifdef tabletView
      this->showStatusBar = false;
    #endif
}

#ifndef do_Not_use_native_apps
  void appNameClass::loop(){
#else
  void SDAppManager_loop(){
#endif
    //EVERY FRAME CODE
    /* 
    #ifndef conf_uno_touch_shield
      // Do not show this label on UNO with touch screen
      drawString_centered("Booting from SD app",SCREEN_WIDTH/2,8);
    #endif
    */

    if (driver_sdcard_init()){
      //drawString("SD card read success",10,20);
      
      os_run_b("/apps/apps_manager.b"); // run bin from sdcard

      #ifndef do_Not_use_native_apps
        #ifndef isTouchScreen
          if (isPressStart_Select()){
            os_switch_to_app(-1);
          }
        #endif
      #endif
      
    }else{
      drawString("Card read fail",10,10);
    }

};