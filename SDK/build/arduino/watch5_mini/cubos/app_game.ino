

/*
 * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 
 * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *
 * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *
 *                                                                                         *
 *                                                                                         *
 *                                  >>>   IMPORTANT!   <<<                                 *
 *                  DO NOT FORGET TO ADD YOUR APP IN os_applications.ino                   *
 *                                                                                         *
 *                                                                                         *
 * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 
 * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *
 * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *
 */

#define appNameClass    SampleGame         // App name without spaces
#define appName         "Game 1"         // App name with spaces (max 16)

class appNameClass: public Application{
    public:
        float player_y = 0;
        float player_x = 0;
        float player_v_y = 0;

        long delay_timer = 0;
        bool isGameOver = false;

        int block_y = 0;

        virtual void loop() override{
            /*
            * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 
            * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *
            *                                                                                         *
            *                                >>>   MAIN APP LOOP   <<<                                *
            *                                                                                         *
            */

            //EVERY FRAME CODE
            //drawString("Sample game loop",0,10);

            //if (isPressStart_Select()){
                //os_switch_to_app(-1);
            //}
            
            #ifdef control_has_backbtn
              if (isPressStart_Left() || isPressStart_Back()){
                finish();
              }
            #else
              if (isPressStart_Left()){
                finish();
              }
            #endif

            if (isGameOver) game_over_looop();
            else game_loop();

           /*                                                                                         *
            * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 
            * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *
            */

        };

        void finish(){
          os_switch_to_app(-1);
        }

        void new_game(){
            player_y = 0;
            player_v_y = 0;
            player_x = 0;

            delay_timer = 0;
            isGameOver = false;
        }

        void game_loop(){
            player_v_y += SCREEN_HEIGHT/30;
            
            if (isPressStart_Select()){
                player_v_y -= SCREEN_HEIGHT*2;
            }

            player_y += player_v_y * dtime/1000/2;
            player_x += 40*(float)dtime/1000;

            if (player_x>SCREEN_WIDTH*1.1 + 12){
                player_x = 0;  
                block_y = SCREEN_HEIGHT*2*(_millis()%100)/3/100;
            }

            if (player_y<0){
                player_y = 0;
                player_v_y = 0;
            }

            if (player_y + 12>SCREEN_HEIGHT){
                gameOver();
            }

            // Check collision
            int playerx = SCREEN_WIDTH/6;
            int playerx1 = SCREEN_WIDTH/6 + 16;
            int playery = player_y;
            int playery1 = player_y + 12;

            int blockx = (int)(SCREEN_WIDTH - player_x);
            int blockx1 = ( (int)(SCREEN_WIDTH - player_x) ) + 12;
            int blocky = block_y;
            int blocky1 = block_y + SCREEN_HEIGHT/3;

            if (playerx < blockx1 && playerx1 > blockx && playery < blocky1 && playery1 > blocky){
                gameOver();
            }

            drawIcon(player,SCREEN_WIDTH/6,player_y); //icon

            drawLine(0, SCREEN_HEIGHT-1, SCREEN_WIDTH-1, SCREEN_HEIGHT-1);
            
            drawRect(  (int)(SCREEN_WIDTH - player_x) , block_y, ( (int)(SCREEN_WIDTH - player_x) ) + 12, block_y + SCREEN_HEIGHT/3, true); 
        }

        void gameOver(){
            player_y = 0; player_v_y = 0;

            delay_timer = _millis();
            isGameOver = true;
        }

        void game_over_looop(){
          drawString_centered("GAME OVER",SCREEN_WIDTH/2,SCREEN_HEIGHT/2 - FONT_CHAR_HEIGHT - 2);

          if (abs( (int)(delay_timer-_millis())) >3000){ isGameOver = false; new_game();}
          if (abs( (int)(delay_timer-_millis()))>500 && isPressStart_Select()){ isGameOver = false; new_game();}
        }

        void setup(){
            /*
            * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 
            * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *
            *                                                                                         *
            *                              >>>   APP SETUP ON START   <<<                             *
            *                                                                                         *
            */
            new_game();
            // ON START APP CODE

           /*                                                                                         *
            * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 
            * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *
            */
        };

		static unsigned const char* getParams(unsigned char type){
            switch(type){ 
              case PARAM_TYPE_NAME: return (unsigned char*)appName; 
              case PARAM_TYPE_ICON: return icon;
              default: return (unsigned char*)""; }
        };

		const static byte icon[] PROGMEM;
        const static byte player[] PROGMEM; 

        appNameClass(){ // Constructor
            setup();
        };        

};

const byte appNameClass::icon[] PROGMEM = {
	//////////////////////////////////////////////////////////////
	//		PUT YOUR APP ICON HERE
    

    #ifdef colorScreen
        0x02,0x01,0x02,0x20,0x02,0x20,0x04,0xff,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xE0,0x00,0x00,0x07,0xE0,0x00,0x00,0x07,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xE0,0x07,0x00,0x00,0xE0,0x07,0x00,0x04,0xff,0xd9,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xE0,0x00,0x00,0x07,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xE0,0x07,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x04,0xff,0xff,0xff,0x03,0x80,0x01,0xC0,0x03,0x80,0x01,0xC0,0x03,0x80,0x01,0xC0,0x00,0x70,0x0E,0x00,0x00,0x70,0x0E,0x00,0x00,0x70,0x0E,0x00,0x03,0xFF,0xFF,0xC0,0x03,0xFF,0xFF,0xC0,0x03,0xFF,0xFF,0xC0,0x1F,0x8F,0xF1,0xF8,0x1F,0x8F,0xF1,0xF8,0x1F,0x8F,0xF1,0xF8,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xE3,0xFF,0xFF,0xC7,0xE3,0xFF,0xFF,0xC7,0xE3,0xFF,0xFF,0xC7,0xE3,0x80,0x01,0xC7,0xE3,0x80,0x01,0xC7,0xE3,0x80,0x01,0xC7,0x00,0x7E,0x7E,0x00,0x00,0x7E,0x7E,0x00,0x00,0x7E,0x7E,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
    #else
        0x02,0x01,0x02,0x20,0x02,0x20,0x04,0xff,0xff,0xff,0x03,0x80,0x01,0xC0,0x03,0x80,0x01,0xC0,0x03,0x80,0x01,0xC0,0x00,0x70,0x0E,0x00,0x00,0x70,0x0E,0x00,0x00,0x70,0x0E,0x00,0x03,0xFF,0xFF,0xC0,0x03,0xFF,0xFF,0xC0,0x03,0xFF,0xFF,0xC0,0x1F,0x8F,0xF1,0xF8,0x1F,0x8F,0xF1,0xF8,0x1F,0x8F,0xF1,0xF8,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xE3,0xFF,0xFF,0xC7,0xE3,0xFF,0xFF,0xC7,0xE3,0xFF,0xFF,0xC7,0xE3,0x80,0x01,0xC7,0xE3,0x80,0x01,0xC7,0xE3,0x80,0x01,0xC7,0x00,0x7E,0x7E,0x00,0x00,0x7E,0x7E,0x00,0xE0,0x7E,0x7E,0x07,0xE0,0x00,0x00,0x07,0xE0,0x00,0x00,0x07,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xE0,0x07,0x00,0x00,0xE0,0x07,0x00,0x00,0xE0,0x07,0x00,
    #endif
	//
	//////////////////////////////////////////////////////////////
};

const byte appNameClass::player[] PROGMEM  = { //16x12
    0x02,0x01,0x02,0x10,0x02,0x10,0x04,0xff,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x3E,0x00,0x40,0x00,0x3C,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x04,0xff,0xd9,0x00,0x00,0x00,0x00,0x00,0x03,0xC0,0x0F,0x80,0x07,0x80,0x03,0x80,0x01,0xC0,0x45,0x80,0x3B,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x04,0x33,0xff,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x07,0x80,0x0F,0xC0,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x04,0xff,0xff,0xff,0x00,0x00,0x00,0x00,0x00,0x10,0x00,0x28,0x00,0x2C,0x78,0x3C,0x7C,0x00,0x38,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x04,0x00,0x00,0x00,0x00,0x00,0x03,0xF0,0x0C,0x28,0x10,0x54,0x78,0x52,0x84,0x42,0x82,0x3E,0x82,0x41,0x44,0xBE,0x38,0x42,0x10,0x3C,0x0F,0xC0,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
}; 