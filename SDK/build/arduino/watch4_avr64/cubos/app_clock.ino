char current_watchface = 0;

/*
 * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 
 * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *
 * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *
 *                                                                                         *
 *                                                                                         *
 *                                  >>>   IMPORTANT!   <<<                                 *
 *                  DO NOT FORGET TO ADD YOUR APP IN os_applications.ino                   *
 *                                                                                         *
 *                                                                                         *
 * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 
 * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *
 * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *
 */

#define appNameClass    ClockApp           // App name without spaces
#define appName         "Clock"            // App name with spaces (max 16)

class appNameClass: public Application{
    public:

        char res[100];

        char* int2engCharArr(int x)// 0 - 999999
        {
            char *ptr = res;
            const char *a[] = {"zero", "one", "two", "three", "four", "five", "six", "seven", "eight", "nine", "ten", "eleven", "twelve"};

            if(x <= 12)
            {
                ptr += sprintf(ptr,"%s ",a[x]);
                return res;
            }

            if(x >= 20)
            {
                switch(x/10)
                {
                    case 2 : ptr += sprintf(ptr,"twen"); break;
                    case 3 : ptr += sprintf(ptr,"thir"); break;
                    case 5 : ptr += sprintf(ptr,"fif"); break;
                    case 8 : ptr += sprintf(ptr,"eigh"); break;
                    default : ptr += sprintf(ptr,a[x/10]); break;
                }
                ptr += sprintf(ptr,"ty ");
                x %= 10;
            }
            if(x >= 13)
            {
                x %= 10;
                switch(x)
                {
                    case 2 : ptr += sprintf(ptr,"twen"); break;
                    case 3 : ptr += sprintf(ptr,"thir"); break;
                    case 5 : ptr += sprintf(ptr,"fif"); break;
                    case 8 : ptr += sprintf(ptr,"eigh"); break;
                    default : ptr += sprintf(ptr,a[x]);
                }
                ptr += sprintf(ptr,"teen");
            }
            else if(x > 0)
                ptr += sprintf(ptr,"%s ",a[x]);
            return res;
        }

        virtual void loop() override{
            /*
            * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 
            * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *
            *                                                                                         *
            *                                >>>   MAIN APP LOOP   <<<                                *
            *                                                                                         *
            */

            //EVERY FRAME CODE
            app_clock_loop();

            #ifdef control_has_backbtn
              if (isPressStart_Select() || isPressStart_Back()){
                finish();
              }
            #else
              if (isPressStart_Select()){
                finish();
              }
            #endif

           /*                                                                                         *
            * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 
            * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *
            */

        };

        void finish(){
          os_switch_to_app(-1);
        }

        void setup(){
            /*
            * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 
            * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *
            *                                                                                         *
            *                              >>>   APP SETUP ON START   <<<                             *
            *                                                                                         *
            */

            // ON START APP ODE

           /*                                                                                         *
            * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 
            * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *
            */
        };

    static unsigned const char* getParams(unsigned char type){
            switch(type){ 
              case PARAM_TYPE_NAME: return (unsigned char*)appName; 
              case PARAM_TYPE_ICON: return icon;
              default: return (unsigned char*)""; }
        };

    const static byte icon[] PROGMEM;

        appNameClass(){ // Constructor
            setup();
        };

    byte digitMap[11][2] = {
      { 0b11110110, 0b11011110 }, // Digit map - 0
      { 0b01001001, 0b00100100 }, // Digit map - 1
      { 0b11100111, 0b11001110 }, // Digit map - 2
      { 0b11100111, 0b10011110 }, // Digit map - 3
      { 0b10110111, 0b10010010 }, // Digit map - 4
      { 0b11110011, 0b10011110 }, // Digit map - 5
      { 0b11110011, 0b11011110 }, // Digit map - 6
      { 0b11100100, 0b10010010 }, // Digit map - 7
      { 0b11110111, 0b11011110 }, // Digit map - 8
      { 0b11110111, 0b10011110 }, // Digit map - 9
      { 0b00001000, 0b00100000 }, // Digit map - :
    };

    void draw_digit(byte digit, byte pos, int scale, int label_x, int label_y){
      for (int i=0; i<15; i++){
        if (digitMap[digit][i/8]&1<<(7-i%8)){
          
          int x = label_x + pos*4*scale + (i%3)*scale;
          int y = label_y + (i/3)*scale;     
          drawRect( x, y, x + scale, y + scale-1, true);  
          
        }
      }
    }
    
    #ifdef conf_arduinoMega2560_touch
      #define WATCHFACES_COUNT 2
    #else
      #define WATCHFACES_COUNT 3
    #endif

    ////////////////////////////
    //  WATCHFACES:
    //  1. Digital - HH:MM
    //  2. Digital - HH:MM:SS
    //  3. texr

    void app_clock_loop(){

      if (isPressStart_Left()){
        if (current_watchface==WATCHFACES_COUNT-1) current_watchface=0;
        else current_watchface++;
      }else if (isPressStart_Right()){
        if (current_watchface==0) current_watchface = WATCHFACES_COUNT-1;
        else current_watchface--;
      }

      const int center_x = SCREEN_WIDTH/2;
      const int center_y = SCREEN_HEIGHT/2;

      const int radius_small = min(center_x, center_y);
      const int radius_big = max(center_x, center_y);

      if (current_watchface==0 || current_watchface==1){
        int scale = min(SCREEN_WIDTH/(current_watchface==0?19:31), SCREEN_HEIGHT/5);
        int x = (SCREEN_WIDTH - scale*(current_watchface==0?19:31))/2;
        int y = (SCREEN_HEIGHT - scale*5)/2;
        
        draw_digit(os_clock_currentTime_hour()/10,  0, scale, x, y);
        draw_digit(os_clock_currentTime_hour()%10,  1, scale, x, y);
        draw_digit(10, 2, scale, x, y);
        draw_digit(os_clock_currentTime_minutes()/10, 3, scale, x, y);
        draw_digit(os_clock_currentTime_minutes()%10, 4, scale, x, y);
        
        if(current_watchface==1){
          draw_digit(10, 5, scale, x, y);
          draw_digit(os_clock_currentTime_seconds()/10, 6, scale, x, y);
          draw_digit(os_clock_currentTime_seconds()%10, 7, scale, x, y);
        }

      }else if(current_watchface==2){

        if(os_clock_currentTime_hour()>20){
          drawString(int2engCharArr(20), 0, FONT_CHAR_HEIGHT*0, 2);
          drawString(int2engCharArr(os_clock_currentTime_hour()-20), 20, FONT_CHAR_HEIGHT*2, 2);
        }else drawString(int2engCharArr(os_clock_currentTime_hour()), 0, FONT_CHAR_HEIGHT*2, 2);
        if(os_clock_currentTime_hour()==1) drawString("hour", 30, FONT_CHAR_HEIGHT*4 - 1);
        else drawString("hours", 30, FONT_CHAR_HEIGHT*4 - 1);
        if(os_clock_currentTime_minutes()/10 == 2 || os_clock_currentTime_minutes()/10 == 3 || os_clock_currentTime_minutes()/10 == 4) drawString(int2engCharArr(os_clock_currentTime_minutes()/10*10), 0, FONT_CHAR_HEIGHT*5 +1, 2);
        else drawString(int2engCharArr(os_clock_currentTime_minutes()/5*5), 0, FONT_CHAR_HEIGHT*5+1, 2);
        if (os_clock_currentTime_minutes()==1) drawString("minute",                                       20, FONT_CHAR_HEIGHT*7);
        else drawString("minutes", 30, FONT_CHAR_HEIGHT*7);

      }
    }

};

const byte appNameClass::icon[] PROGMEM =  {  //128
  //////////////////////////////////////////////////////////////
  //    PUT YOUR ICON HERE

  #ifdef colorScreen
    0x02,0x01,0x02,0x20,0x02,0x20,0x04,0x00,0x66,0xff,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x0F,0xF0,0x00,0x00,0x3F,0xFC,0x00,0x00,
    0xFF,0xFF,0x00,0x01,0xFF,0xFF,0x80,0x03,0xFF,0xFF,0xC0,0x07,0xFF,0xFF,0xE0,0x0F,0xFF,0xFF,0xF0,0x1F,0xFF,0xFF,0xE0,0x19,0xFF,0xFF,0x80,
    0x18,0x7F,0xFE,0x00,0x3E,0x1F,0xF8,0x1C,0x3F,0x87,0xE0,0x7C,0x3F,0xE1,0x81,0xFC,0x3F,0xF8,0x07,0xFC,0x3F,0xFE,0x1F,0xFC,0x3F,0xFE,0x7F,
    0xFC,0x3F,0xFE,0x7F,0xFC,0x3F,0xFE,0x7F,0xFC,0x1F,0xFE,0x7F,0xF8,0x1F,0xFE,0x7F,0xF8,0x0F,0xFE,0x7F,0xF0,0x0F,0xFE,0x7F,0xF0,0x07,0xFE,
    0x7F,0xE0,0x03,0xFE,0x7F,0xC0,0x01,0xFE,0x7F,0x80,0x00,0xFE,0x7F,0x00,0x00,0x3E,0x7C,0x00,0x00,0x0E,0x70,0x00,0x00,0x00,0x00,0x00,0x00,
    0x00,0x00,0x00,0x04,0xff,0xff,0xff,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
    0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x04,0x00,0x00,0x00,0x1C,0x06,0x00,0x00,0x78,0x07,0x80,0x01,
    0xE0,0x01,0xE0,0x07,0x80,0x00,0x78,0x1E,0x00,0x00,0x1E,0x78,0x00,0x00,0x07,0xE0,0x00,0x00,0x01,0x80,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
    0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
    0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
    0x04,0xb4,0xb4,0xb4,0x00,0x0F,0xF0,0x00,0x00,0x7F,0xFE,0x00,0x01,0xF0,0x0F,0x80,0x03,0xC0,0x03,0xC0,0x07,0x00,0x00,0xE0,0x0E,0x00,0x00,
    0x70,0x1C,0x00,0x00,0x38,0x38,0x00,0x00,0x1C,0x30,0x00,0x00,0x08,0x60,0x00,0x00,0x02,0x60,0x00,0x00,0x06,0x60,0x00,0x00,0x06,0xC0,0x00,
    0x00,0x03,0xC0,0x00,0x00,0x03,0xC0,0x00,0x00,0x03,0xC0,0x00,0x00,0x03,0xC0,0x00,0x00,0x03,0xC0,0x00,0x00,0x03,0xC0,0x00,0x00,0x03,0xC0,
    0x00,0x00,0x03,0x60,0x00,0x00,0x06,0x60,0x00,0x00,0x06,0x70,0x00,0x00,0x0E,0x30,0x00,0x00,0x0C,0x38,0x00,0x00,0x1C,0x1C,0x00,0x00,0x38,
    0x0E,0x00,0x00,0x70,0x07,0x00,0x00,0xE0,0x03,0xC0,0x03,0xC0,0x01,0xF0,0x0F,0x80,0x00,0x7E,0x7E,0x00,0x00,0x0E,0x70,0x00,0x04,0x00,0x00,
    0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
    0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x18,0x00,0x00,0x00,0x60,0x00,
    0x00,0x01,0x80,0x00,0x00,0x06,0x00,0x00,0x00,0x18,0x00,0x00,0x00,0x60,0x00,0x00,0x01,0x80,0x00,0x00,0x01,0x80,0x00,0x00,0x01,0x80,0x00,
    0x00,0x01,0x80,0x00,0x00,0x01,0x80,0x00,0x00,0x01,0x80,0x00,0x00,0x01,0x80,0x00,0x00,0x01,0x80,0x00,0x00,0x01,0x80,0x00,0x00,0x01,0x80,
    0x00,0x00,0x01,0x80,0x00,0x00,0x01,0x80,0x00,0x00,0x01,0x80,0x00,0x00,0x01,0x80,0x00,0x00,0x01,0x80,0x00,
  #else

    #ifdef conf_atm328_nokia_watch
      0x02,0x01,0x02,0x20,0x02,0x18,0x04,0x00,0x00,0x00,0x00,0x0F,0xF0,0x00,0x00,0x7F,0xFE,0x00,0x01,0xF1,0x8F,0x80,0x03,0x80,0x01,0xC0,0x06,0x00,0x00,0x60,0x0C,0x00,0x03,0x30,0x18,0x00,0x06,0x18,0x18,0x00,0x0C,0x18,0x30,0x00,0x18,0x0C,0x30,0x00,0x30,0x0C,0x30,0x01,0x60,0x0C,0x39,0xFF,0xC0,0x1C,0x39,0xFF,0xC0,0x1C,0x30,0x01,0x80,0x0C,0x30,0x00,0x00,0x0C,0x30,0x00,0x00,0x0C,0x18,0x00,0x00,0x18,0x18,0x00,0x00,0x18,0x0C,0x00,0x00,0x30,0x06,0x00,0x00,0x60,0x03,0x80,0x01,0xC0,0x01,0xF1,0x8F,0x80,0x00,0x7F,0xFE,0x00,0x00,0x0F,0xF0,0x00,
    #else
      0x02,0x01,0x02,0x20,0x02,0x20,0x04,0x00,0x00,0x00,0x00,0x0F,0xF0,0x00,0x00,0x7F,0xFE,0x00,0x01,0xF0,0x0F,0x80,0x03,0xC0,0x03,0xC0,0x07,
      0x00,0x00,0xE0,0x0E,0x00,0x00,0x70,0x1C,0x00,0x00,0x38,0x38,0x00,0x00,0x1C,0x30,0x00,0x00,0x0C,0x60,0x00,0x00,0x06,0x66,0x00,0x00,0x46,
      0x67,0x80,0x01,0xC6,0xC1,0xE0,0x07,0x83,0xC0,0x78,0x1E,0x03,0xC0,0x1E,0x78,0x03,0xC0,0x07,0xE0,0x03,0xC0,0x01,0x80,0x03,0xC0,0x01,0x80,
      0x03,0xC0,0x01,0x80,0x03,0xC0,0x01,0x80,0x03,0x60,0x01,0x80,0x06,0x60,0x01,0x80,0x06,0x70,0x01,0x80,0x0E,0x30,0x01,0x80,0x0C,0x38,0x01,
      0x80,0x1C,0x1C,0x01,0x80,0x38,0x0E,0x01,0x80,0x70,0x07,0x01,0x80,0xE0,0x03,0xC1,0x83,0xC0,0x01,0xF0,0x0F,0x80,0x00,0x7F,0xFE,0x00,0x00,
      0x0F,0xF0,0x00,
    #endif
  #endif

  //
  //////////////////////////////////////////////////////////////
};